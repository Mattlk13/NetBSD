VERSION: :1,$s/2021-05-14/2021-05-14/g
ISO:     :1,$s/202105120800Z/202105120800Z/g
NetBSD:  :1,$s/9.99.82/9.99.82/g
PKGSRC:  :1,$s/2021-1/2021-1/
# Check MD5 filename before post this mail.
# why dont we take off alone.

To: port-armNetBSD.org@localhost
Subject: 2021-05-14-netbsd-raspi-aarch64.img
From: Jun Ebihara <jun@soum.co.jp>

I've updated 2021-05-14-netbsd-raspi-aarch64.img.gz for RPI4.

http://cdn.netbsd.org/pub/NetBSD/misc/jun/raspberry-pi/2021-05-14-aarch64/2021-05-14-netbsd-raspi-aarch64.img.gz
http://cdn.netbsd.org/pub/NetBSD/misc/jun/raspberry-pi/2021-05-14-aarch64/MD5

Topics:
- gcc-10
- libssh-40
- openssh-8.6
- openssl-1.1.1k
- git-base-2.31.1nb1
- bind-9.16.15
- UEFI v1.26
 https://github.com/pftf/RPi4/releases
    Add Cypress WiFi firmware binaries to archive
    Revert to full device discovery during init by default, and add new "Fast Boot" feature for partial discovery (#114, #117, #144) [tianocore/edk2-platforms@efdc159]
    Fix wrong miniUART baudrate [tianocore/edk2-platforms@d2339f3]

- only for RPI4 
  (fill dtb for RPI3?)
- build script
 https://github.com/ebijun/NetBSD/tree/master/RPI/RPIimage/Image/aarch64
- [Issue] Can't recognize DOS partition from Windows
  Should I Use MBR version image?

sysinfo:
 bind-9.16.15 bozohttpd-20210504 g++-10.3.0 gcc-10.3.0 libdrm-3.5
 libssh-40.0 libX11-7.1 NetBSD-9.99.82 openssh-8.6 opensshd-8.6
 openssl-1.1.1k pkg_install-20210410 sh-20181212-20210512063928Z
 unbound-1.13.1 userland-NetBSD-9.99.82/evbarm
 wpa_supplicant-2.9 yacc-2.0

pkgsrc:
 bash-5.1.8 cairo-1.16.0nb3 curl-7.76.1nb1 dbus-1.12.20nb1
 fossil-2.15.1nb1 gd-2.3.2 gdk-pixbuf2-2.40.0nb2 git-base-2.31.1nb1
 glib2-2.68.2 gnutls-3.7.1nb1 gobject-introspection-1.68.0
 gtk2+-2.24.33nb1 gtk3+-3.24.29 icu-69.1 libcups-2.3.3op2nb1
 libgcrypt-1.9.3 libgpg-error-1.42 libimagequant-2.14.1
 libxkbcommon-1.3.0 libxml2-2.9.10nb4 libxslt-1.1.34nb5
 m17n-lib-1.8.0nb5 medit-1.2.0nb18 mlterm-3.9.1nb1
 nettle-3.7.2 nghttp2-1.43.0nb2 p5-Digest-HMAC-1.04nb10
 p5-IO-Socket-SSL-2.070 p5-Net-DNS-1.30 p5-Net-SSLeay-1.90
 pango-1.48.4 py38-cElementTree-3.8.10 py38-expat-3.8.10
 python38-3.8.10 qt5-qtbase-5.15.2nb4 qt5-qtx11extras-5.15.2nb2
 qt5-qtxmlpatterns-5.15.2nb2 ruby26-base-2.6.7 ruby26-cairo-1.17.5
 ruby26-mikutter-4.1.5 ruby26-native-package-installer-1.1.1
 ruby26-nokogiri-1.11.2nb1 ruby26-pkg-config-1.4.6
 ruby26-red-colors-0.1.1 ruby26-simpleidn-0.2.1
 shared-mime-info-1.10nb4 sudo-1.9.6p1 tiff-4.3.0
 uim-1.8.9pre20210104nb1 wayland-1.18.0nb3 wget-1.21.1nb1
 zstd-1.4.9

RPI4 status:
- boot via UEFI_VER=v1.26
 https://github.com/pftf/RPi4/releases

In this image,pre-setted RPI_EFI.fd
 Advanced Configration
 -> Limit RAM to 3GB	Disabled

 SD/MMC Configration
 -> uSD/eMMC Routing	Arasan SDHCI

- HDMI: works
- audio: vcaudio
  http://mail-index.netbsd.org/source-changes-d/2021/01/22/msg013133.html
- USB device: works
- bwfm0 Wireless network:?
  (works well on RPI3,not works on RPI4?)
- Pi 4 Bootloader Configuration
  https://www.raspberrypi.org/documentation/hardware/raspberrypi/bcm2711_bootloader_config.md

Update:
- NetBSD-current 9.99.82 evbarm-aarch64 202105120800Z arm64.img from nyftp.
- boot via UEFI_VER=v1.26
- pkginfo
 https://github.com/ebijun/NetBSD/blob/master/RPI/RPIimage/Image/aarch64/pkginfo
- sysinfo
 https://github.com/ebijun/NetBSD/blob/master/RPI/RPIimage/Image/aarch64/sysinfo

Update from 2021-04-15:
 https://github.com/ebijun/NetBSD/commit/311716537054e1e42d5a3fef37a0c91faeb4d390#diff-cf95b12b2b3d346ddb27e4ed98c4177abc48e486232bc9e4ebd71a74da610dfb

- mate/firefox/inkscape/libreoffice works well
   pkg_add mate
   pkg_add gvfs
   pkg_add firefox
   pkg_add firefox-l10n
   pkg_add libreoffice
   pkg_add inkscape
   pkg_add gimp
   pkg_add scribus
   pkg_add py38-sphinx
   pkg_add wxGTK30
   pkg_add gnome-keyring

- Sphinx with latexpdf
  https://github.com/ebijun/NetBSD/blob/master/Guide/latexpdf.rst 

- pkgin: upgrade failed
- raspberry-pi userland: compile failed 

Pre-installed packages:
  bash
  tcsh
  vlgothic-ttf
  icewm
  xli
  ruby26-mikutter
  uim
  fossil
  sudo
  git-base
  zsh
  mlterm
  pkg_chk
  lintpkgsrc
  mozilla-rootcerts
  dillo
  medit
  lrzsz

- pre-build packages:
  See /etc/pkg_install.conf
  PKG_PATH=http://cdn.netbsd.org/pub/NetBSD/misc/jun/raspberry-pi/aarch64/2021-1/

pkgsrc: 
  # cd /usr
  # ftp http://cdn.netbsd.org/pub/pkgsrc/current/pkgsrc.tar.gz
  # ls /usr/pkgsrc                ... check if exists.
  # tar tzvf pkgsrc.tar.gz |head  ... check the archive
  # tar xzvf pkgsrc.tar.gz        ... extract
  # ls /usr/pkgsrc                ... check what extracted
  # pkg_chk -g                    ... List to/usr/pkgsrc/pkgchk.conf
  # (cd /usr/pkgsrc;cvs update -PAd) ... update
  # pkg_chk -un                   ... Update (listup)
  # pkg_chk -u                    ... Update

EEPROM verson:
 Check&update with Raspberry Pi OS (pi:raspberry)
 pi@raspberrypi:~ $ cat /etc/default/rpi-eeprom-update 
 FIRMWARE_RELEASE_STATUS="stable"
 pi@raspberrypi:~ $ sudo rpi-eeprom-update
 BCM2711 detected
 Dedicated VL805 EEPROM detected
 BOOTLOADER: up-to-date
 CURRENT: Thu 16 Jul 15:15:46 UTC 2020 (1594912546)
 LATEST: Thu 16 Jul 15:15:46 UTC 2020 (1594912546)
 FW DIR: /lib/firmware/raspberrypi/bootloader/stable
 VL805: up-to-date
 CURRENT: 000138a1
 LATEST: 000138a1

--
Jun Ebihara
