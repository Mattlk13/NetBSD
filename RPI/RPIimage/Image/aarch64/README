VERSION: :1,$s/2023-08-22/2023-08-22/g
ISO:     :1,$s/202308210630Z/202308210630Z/g
NetBSD:  :1,$s/10.99.7/10.99.7/g
PKGSRC:  :1,$s/2022/2022/
# Check MD5 filename before post this mail.
# why dont we take off alone.

To: port-armNetBSD.org@localhost
Subject: 2023-08-22-netbsd-raspi-aarch64.img
From: Jun Ebihara <jun@soum.co.jp>

I've updated 2023-08-22-netbsd-raspi-aarch64.img.gz for RPI4.

https://cdn.netbsd.org/pub/NetBSD/misc/jun/raspberry-pi/2023-08-22-aarch64/2023-08-22-netbsd-raspi-aarch64.img.gz
https://cdn.netbsd.org/pub/NetBSD/misc/jun/raspberry-pi/2023-08-22-aarch64/MD5

Topics:
- enlarge image file size
- bind-9.16.42
- g++-10.5.0
- gcc-10.5.0
- libc-12.221
- libssh-45.0
- NetBSD-10.99.7
- openssh-9.3
- icu-73.2nb1
- mozilla-rootcerts-1.0.20230720
- perl-5.38.0
- python311-3.11.4nb2
- ruby31-base-3.1.4nb1
- Can't get twitter API access.
  drop ruby31-mikutter-plugins-twitter
- Raspberry Pi 4 UEFI Firmware v1.35

- pkgsrc/inputmethod/uim build failed
  ld: connection.cpp:(.text+0x4d0): undefined reference to `alloca'
  ximic.cpp:(.text+0x710): undefined reference to `alloca'
  ximic.cpp:(.text+0xe18): undefined reference to `alloca'
  ximic.cpp:(.text+0x13d0): undefined reference to `alloca'
  ximtrans.cpp:(.text+0xd7c): undefined reference to `alloca'
  ld: uim_xim-ximtrans.o:ximtrans.cpp:(.text+0x11fc): more undefined references to `alloca' follow

- SD/MMC Configration
  Switch Default uSD/eMMC Routing: Arasan SDHCI -> EMMC2
 http://mail-index.netbsd.org/port-arm/2021/08/08/msg007393.html
  the Arasan SDHCI is used to connect bwfm(4). 

In this image, a synbolic link added

/libdata/firmware/if_bwfm:
ln -s brcmfmac43455-sdio.raspberrypi,4-model-b.txt "brcmfmac43455-sdio.Raspberry Pi 4 Model B.txt"
to avoid
bwfm0: autoconfiguration error: NVRAM file not available
 
- only for RPI4 
  (fill dtb for RPI3?)
- build script
 https://github.com/ebijun/NetBSD/tree/master/RPI/RPIimage/Image/aarch64
- [Issue] Can't recognize DOS partition from Windows
  Should I Use MBR version image?

- rpi cm4 + waveshare mini base board B seems stop after kernel load
  fixed: To use USB,set UEFI+FDT 
  http://mail-index.netbsd.org/port-arm/2021/06/30/msg007343.html
  http://mail-index.netbsd.org/port-arm/2022/10/03/msg007875.html

- pkgin support
  edit /usr/pkg/etc/pkgin/repositories.conf
  cf.
  http://cdn.netbsd.org/pub/NetBSD/misc/jun/raspberry-pi/aarch64/2023
  and pkgin update

sysinfo:
 bind-9.16.42 dhcpcd-10.0.2 g++-10.5.0 gcc-10.5.0 libc-12.221 libssh-45.0
 NetBSD-10.99.7 openssh-9.3 opensshd-9.3 libpcap-1.10.4
 sh-20220122-20230821004149Z tcpdump-4.99.4 userland-NetBSD-10.99.7/evbarm

pkgsrc:
 at-spi2-atk-2.38.0nb2 at-spi2-core-2.40.3nb3 atk-2.38.0nb1 curl-8.2.1nb1
 fontconfig-2.14.2nb2 fossil-2.22 freetype2-2.13.1 gdk-pixbuf2-2.42.10nb3
 git-base-2.41.0nb2 glib2-2.76.4nb1 gmp-6.3.0 gnutls-3.8.1
 gobject-introspection-1.76.1nb1 graphite2-1.3.14nb2
 gsettings-desktop-schemas-40.0nb2 gtk2+-2.24.33nb11 gtk3+-3.24.38nb1
 harfbuzz-8.0.1nb1 icu-73.2nb1 libcups-2.4.6nb1 libimagequant-4.2.0nb1
 libpaper-2.1.1 libproxy-0.5.3 libpsl-0.21.2nb1 libuuid-2.32.1nb2
 libwebp-1.3.1 libxkbcommon-1.5.0nb2 libxml2-2.10.4nb2 libxslt-1.1.38nb1
 medit-1.2.0nb25 mozilla-rootcerts-1.0.20230720 nghttp2-1.55.1
 p11-kit-0.25.0 pango-1.50.14nb1 perl-5.38.0 png-1.6.40
 py311-cElementTree-3.11.4 py311-expat-3.11.4nb1 python311-3.11.4nb2
 qt5-qtbase-5.15.10 qt5-qtx11extras-5.15.10 qt5-qtxmlpatterns-5.15.10
 ruby31-addressable-2.8.5 ruby31-atk-4.1.9 ruby31-base-3.1.4nb1
 ruby31-cairo-1.17.12 ruby31-cairo-gobject-4.1.9 ruby31-gdk_pixbuf2-4.1.9
 ruby31-gio2-4.1.9 ruby31-glib2-4.1.9 ruby31-gobject-introspection-4.1.9
 ruby31-mikutter-5.0.5 ruby31-mini_portile2-2.8.4
 ruby31-native-package-installer-1.1.8 ruby31-nokogiri-1.14.4
 ruby31-pango-4.1.9 ruby31-pkg-config-1.5.2 ruby31-public_suffix-5.0.3
 shared-mime-info-2.2nb3 sudo-1.9.14p3 tiff-4.5.1nb1 vlgothic-ttf-20220612
 wayland-protocols-1.32

RPI4 status:
- boot via UEFI_VER=v1.35
  https://github.com/pftf/RPi4/releases

In this image,pre-setted /boot/RPI_EFI.fd
1. Advanced Configration
 -> Limit RAM to 3GB	Disabled
2. Boot order, from microSD

- HDMI: works
- audio: vcaudio
  http://mail-index.netbsd.org/source-changes-d/2021/01/22/msg013133.html
- USB device: works
- bwfm0 Wireless network:?
  (works well on RPI3,not works on RPI4?)
- Pi 4 Bootloader Configuration
  https://www.raspberrypi.org/documentation/hardware/raspberrypi/bcm2711_bootloader_config.md

Update:
- NetBSD-current 10.99.7 evbarm-aarch64 202308210630Z arm64.img from nyftp.
- pkginfo
 https://github.com/ebijun/NetBSD/blob/master/RPI/RPIimage/Image/aarch64/pkginfo
- sysinfo
 https://github.com/ebijun/NetBSD/blob/master/RPI/RPIimage/Image/aarch64/sysinfo

Update from 20221-06:
https://github.com/ebijun/NetBSD/commit/1b3ef330ecf023aa73d58ccb8b4029c520f33cdf

- mate/firefox/inkscape/libreoffice works well
   pkg_add mate
   pkg_add gvfs
   pkg_add firefox
   pkg_add firefox-l10n
   pkg_add libreoffice
   pkg_add inkscape
   pkg_add gimp
   pkg_add scribus
   pkg_add py310-sphinx
   pkg_add wxGTK30
   pkg_add gnome-keyring

- Sphinx with latexpdf
  https://github.com/ebijun/NetBSD/blob/master/Guide/latexpdf.rst 

- pkgin: upgrade failed
- raspberry-pi userland: compile failed 

Pre-installed packages:
  bash
  tcsh
  vlgothic-ttf
  icewm
  xli
  ruby31-mikutter
  uim
  fossil
  sudo
  git-base
  zsh
  mlterm
  pkg_chk
  lintpkgsrc
  mozilla-rootcerts
  dillo
  medit
  lrzsz

- pre-build packages:
  See /etc/pkg_install.conf
  PKG_PATH=http://cdn.netbsd.org/pub/NetBSD/misc/jun/raspberry-pi/aarch64/2023/

pkgsrc: 
  # cd /usr
  # ftp http://cdn.netbsd.org/pub/pkgsrc/current/pkgsrc.tar.gz
  # ls /usr/pkgsrc                ... check if exists.
  # tar tzvf pkgsrc.tar.gz |head  ... check the archive
  # tar xzvf pkgsrc.tar.gz        ... extract
  # ls /usr/pkgsrc                ... check what extracted
  # pkg_chk -g                    ... List to/usr/pkgsrc/pkgchk.conf
  # (cd /usr/pkgsrc;cvs update -PAd) ... update
  # pkg_chk -un                   ... Update (listup)
  # pkg_chk -u                    ... Update

EEPROM verson:
 Check&update with Raspberry Pi OS (pi:raspberry)
 pi@raspberrypi:~ $ cat /etc/default/rpi-eeprom-update 
 FIRMWARE_RELEASE_STATUS="stable"
 pi@raspberrypi:~ $ sudo rpi-eeprom-update
 BCM2711 detected
 Dedicated VL805 EEPROM detected
 BOOTLOADER: up-to-date
 CURRENT: Thu 16 Jul 15:15:46 UTC 2020 (1594912546)
 LATEST: Thu 16 Jul 15:15:46 UTC 2020 (1594912546)
 FW DIR: /lib/firmware/raspberrypi/bootloader/stable
 VL805: up-to-date
 CURRENT: 000138a1
 LATEST: 000138a1

--
Jun Ebihara

Thanx Ryo@
