To: port-arm%netbsd.org@localhost
Subject: apple m1 status update (20240715)

Install:
 https://wiki.netbsd.org/ports/evbarm/apple/

Update:
 gcc-12.4.0
 openssh-9.8
 firefox-127.0.2     - start failed
 firefox115-115.12.0 - works fine
 libreoffice-24.2.4.2- start failed
 
failed:
 firefox-121.0.1 still fail on my aarch64 environment.
 firefox-119.0.1 fine.

Topics:
- USB2 audio

works ok
 uaudio0 at uhub5 port 1 configuration 1 interface 0
 uaudio0: LUXMAN LXU-OT2 (0x08bb) LUXMAN LXU-OT2 (0x2704), rev 1.10/1.00, addr 17
 uaudio0: audio rev 1.00
 audio0 at uaudio0: playback
 audio0: slinear_le:16 2ch 48000Hz, blk 11520 bytes (60ms) for playback

recognize ok ,but sound output awful just like boss overdrive compressor.
 uaudio0 at uhub5 port 1 configuration 1 interface 0
 uaudio0: Topping (0x152a) D10s (0x8750), rev 2.00/1.04, addr 5
 uaudio0: ignored setting with format 0x80000000
 uaudio0: audio rev 2.00
 audio0 at uaudio0: playback
 audio0: slinear_le:16 2ch 48000Hz, blk 11520 bytes (30ms) for playback

- pkgsrc/textproc/ruby-nokogiri
  make package 
    ok with ar 2.34
    failed with ar 2.39

- X
 startx failed with signal 11,
 till NetBSD-10.99.2-evbarm-aarch64-202302150640Z

X.Org X Server 1.21.1.7
[    40.591] (EE) Backtrace:
[    40.592] (EE) 0: /usr/X11R7/bin/X (xorg_backtrace+0x3c) [0x9761b8c]
[    40.592] (EE) 1: /usr/X11R7/bin/X (os_move_fd+0x78) [0x975d4f8]
[    40.592] (EE) 2: /usr/lib/libc.so.12 (__sigtramp_siginfo_2+0x0) [0xf7d48807e1e8]
[    40.592] (EE) 3: /usr/X11R7/bin/X (CreateColormap+0x418) [0x9644a68]
[    40.592] (EE) 4: /usr/X11R7/bin/X (miCreateDefColormap+0x84) [0x96b7744]
[    40.592] (EE) 5: /usr/X11R7/lib/modules/drivers/wsfb_drv.so (+0x147c) [0xf7d4874e322c]
[    40.592] (EE) 6: /usr/X11R7/bin/X (AddScreen+0xac) [0x9639c6c]
[    40.592] (EE) 7: /usr/X11R7/bin/X (InitOutput+0x26c) [0x967616c]
[    40.592] (EE) 8: /usr/X11R7/bin/X (dix_main+0x1a0) [0x9608fd0]
[    40.592] (EE) 
[    40.592] (EE) Segmentation fault at address 0xf7d487aa07f0
[    40.592] (EE) 
Fatal server error:
[    40.592] (EE) Caught signal 11 (Segmentation fault). Server aborting

 startx but colormap
  https://twitter.com/ebijun/status/1583622834990956545
 
 startx -- -depth 30
  http://mail-index.netbsd.org/port-arm/2021/10/21/msg007458.html
  https://twitter.com/ebijun/status/1480042814704873473

 application checked via tigervnc.
  https://twitter.com/ebijun/status/1615544069161357314

- pkgsrc/net/tigervnc build failed depends:
  x11/libXfont2:
  ERROR: This package has set PKG_SKIP_REASON:
  ERROR: Package set is using native X11 component
  works with comment out 
  #.include "../../x11/libXfont2/buildlink3.mk"

- pkgsrc/x11/xterm failed
  ld: fontutils.o: undefined reference to symbol 'FT_Load_Char'
  ld: /usr/X11R7/lib/libfreetype.so.19: error adding symbols: DSO missing from command line


Hardware:
 Apple Mac mini M1 2020 A2348 
 USB SSD 512GB BUFFALO SSD-PGM2.0U3-BC

Filesystem   1M-blocks      Used     Avail %Cap Mounted on
/dev/dk6        480587    249784    206773  54% /
/dev/dk5            79        34        44  43% /boot
ptyfs                0         0         0 100% /dev/pts
procfs               0         0         0 100% /proc
tmpfs             1912         9      1903   0% /var/shm
/dev/sd0a       946388    473570    425499  52% /media

ToDo:
- audio
- Wireless LAN

pkgsrc:
- pkgsrc packages:
 http://cdn.netbsd.org/pub/NetBSD/misc/jun/aarch64/aarch64/2024/
  pkgin support

System Updates:

sysinfo:
 g++-12.4.0 gcc-12.4.0 libdrm-3.8 libssh-47.0 NetBSD-10.99.11 openssh-9.8
 opensshd-9.8 sh-20220122-20240714064311Z userland-NetBSD-10.99.11/evbarm
 
pkgsrc:
 SDL2-2.30.5 abseil-20240116.2nb1 apache-2.4.61 cmake-3.30.0 dav1d-1.4.3
 dillo-3.1.1 emacs28-28.2nb21 enchant2-2.8.1 firefox-127.0.2
 firefox-l10n-127.0.2 firefox115-115.12.0 firefox115-l10n-115.12.0 fltk-1.3.9nb2
 fmtlib-11.0.1 gcc12-libs-12.4.0nb1 gd-2.3.3nb14 gdk-pixbuf2-2.42.12
 gnutls-3.8.6 graphviz-12.0.0nb1 gst-plugins1-bad-1.24.5
 gst-plugins1-base-1.24.5 gst-plugins1-good-1.24.5 gstreamer1-1.24.5
 guile30-3.0.10 harfbuzz-9.0.0 harfbuzz-icu-9.0.0 icewm-3.6.0 ldb-2.9.1
 libaom-3.9.1 libass-0.17.3 libcups-2.4.10 libgpg-error-1.50 libgsf-1.14.52
 libksba-1.6.7 libproxy-0.5.7 libreoffice-24.2.4.2 librsvg-2.58.1
 libsecret-0.20.5 libsixel-1.8.6nb21 libxml2-2.12.8 libxslt-1.1.42 llvm-18.1.8
 lua54-5.4.7 m17n-lib-1.8.0nb17 mate-1.26.1nb12 mate-panel-1.26.6
 mlterm-3.9.3nb11 mozilla-rootcerts-1.0.20240702 mozilla-rootcerts-openssl-2.16
 nettle-3.10 nginx-1.26.1nb2 nss-3.102 p11-kit-0.25.5 p5-CGI-4.66
 p5-ExtUtils-Helpers-0.027 p5-HTML-TreeBuilder-LibXML-0.28
 p5-IO-Socket-SSL-2.086 p5-Test-Without-Module-0.22 pango-1.54.0 pinentry-1.3.1
 pixman-0.43.4 pkg_install-20240307 protobuf-27.2 py-cairo-shared-1.26.1
 py311-Pillow-10.4.0nb1 py311-cairo-1.26.1 py311-certifi-2024.7.4
 py311-hatchling-1.25.0 py311-importlib-metadata-8.0.0 py311-libxml2-2.12.8
 py311-packaging-24.1 py311-pip-24.1.1 py311-puremagic-1.25
 py311-setuptools-70.2.0 py311-trove-classifiers-2024.7.2 py311-urllib3-2.2.2
 raqm-0.10.1 rarian-0.8.5 samba-4.20.2 tex-firstaid-1.1c tinyxml-2.6.2nb2
 vala-0.56.17nb1 vte3-0.76.3 wxGTK30-3.0.5.1nb16 xdg-utils-1.2.1
 xfce4-4.18.1nb16 xfce4-power-manager-4.18.4 xfce4-session-4.18.4
 xfce4-settings-4.18.6 zziplib-0.13.77

Version: 
 NetBSD 10.99.11 (GENERIC64) #0: Sun Jul 14 06:43:11 UTC 2024  mkrepro@mkrepro.NetBSD.org:/usr/src/sys/arch/evbarm/compile/GENERIC64

dmesg:
 https://github.com/ebijun/NetBSD/blob/master/dmesg/aarch64/Apple_Mac_mini_M1_2020

sysinfo:
 https://github.com/ebijun/NetBSD/blob/master/apple-m1/sysinfo

pkginfo:
 https://github.com/ebijun/NetBSD/blob/master/apple-m1/pkginfo

pkgchk.conf:
 https://github.com/ebijun/NetBSD/blob/master/apple-m1/pkgchk.conf
  cp pkgchk.conf /usr/pkgsrc;pkg_add pkg_chk; pkg_chk -au

--
Jun Ebihara
