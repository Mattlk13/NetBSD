To: port-arm%netbsd.org@localhost
Subject: apple m1 status update (20230610)

Install:
 https://wiki.netbsd.org/ports/evbarm/apple/

Update
 openssl-3.0.9
 ffmpeg6-6.0nb1
 firefox-112.0.1nb4

Topics:
- firefox build failed on 113.0.2
  ld: libxul.so: hidden symbol _ZN7mozilla3dom14Report_Binding20GetConstructorObjectEP9JSContext isn't defined
- /usr/pkg/bin/firefox
1. need comment out these lines.
    echo "Applying libEGL LD_PRELOAD workaround for NetBSD" 
    export LD_PRELOAD=/usr/X11R7/lib/libEGL.so
2. firefox --safe-mode and about:preferences uncheck these option
   Use recommended performance settings
   Use hardware acceleration when available

- USB2 audio

works ok
 uaudio0 at uhub5 port 1 configuration 1 interface 0
 uaudio0: LUXMAN LXU-OT2 (0x08bb) LUXMAN LXU-OT2 (0x2704), rev 1.10/1.00, addr 17
 uaudio0: audio rev 1.00
 audio0 at uaudio0: playback
 audio0: slinear_le:16 2ch 48000Hz, blk 11520 bytes (60ms) for playback

recognize ok ,but sound output awful just like boss overdrive compressor.
 uaudio0 at uhub5 port 1 configuration 1 interface 0
 uaudio0: Topping (0x152a) D10s (0x8750), rev 2.00/1.04, addr 5
 uaudio0: ignored setting with format 0x80000000
 uaudio0: audio rev 2.00
 audio0 at uaudio0: playback
 audio0: slinear_le:16 2ch 48000Hz, blk 11520 bytes (30ms) for playback

- pkgsrc/textproc/ruby-nokogiri
  make package 
    ok with ar 2.34
    failed with ar 2.39

- X
 startx failed with signal 11,
 till NetBSD-10.99.2-evbarm-aarch64-202302150640Z

X.Org X Server 1.21.1.7
[    40.591] (EE) Backtrace:
[    40.592] (EE) 0: /usr/X11R7/bin/X (xorg_backtrace+0x3c) [0x9761b8c]
[    40.592] (EE) 1: /usr/X11R7/bin/X (os_move_fd+0x78) [0x975d4f8]
[    40.592] (EE) 2: /usr/lib/libc.so.12 (__sigtramp_siginfo_2+0x0) [0xf7d48807e1e8]
[    40.592] (EE) 3: /usr/X11R7/bin/X (CreateColormap+0x418) [0x9644a68]
[    40.592] (EE) 4: /usr/X11R7/bin/X (miCreateDefColormap+0x84) [0x96b7744]
[    40.592] (EE) 5: /usr/X11R7/lib/modules/drivers/wsfb_drv.so (+0x147c) [0xf7d4874e322c]
[    40.592] (EE) 6: /usr/X11R7/bin/X (AddScreen+0xac) [0x9639c6c]
[    40.592] (EE) 7: /usr/X11R7/bin/X (InitOutput+0x26c) [0x967616c]
[    40.592] (EE) 8: /usr/X11R7/bin/X (dix_main+0x1a0) [0x9608fd0]
[    40.592] (EE) 
[    40.592] (EE) Segmentation fault at address 0xf7d487aa07f0
[    40.592] (EE) 
Fatal server error:
[    40.592] (EE) Caught signal 11 (Segmentation fault). Server aborting

 startx but colormap
  https://twitter.com/ebijun/status/1583622834990956545
 
 startx -- -depth 30
  http://mail-index.netbsd.org/port-arm/2021/10/21/msg007458.html
  https://twitter.com/ebijun/status/1480042814704873473

 application checked via tigervnc.
  https://twitter.com/ebijun/status/1615544069161357314

- pkgsrc/net/tigervnc build failed depends:
  x11/libXfont2:
  ERROR: This package has set PKG_SKIP_REASON:
  ERROR: Package set is using native X11 component
  works with comment out 
  #.include "../../x11/libXfont2/buildlink3.mk"

- pkgsrc/x11/xterm failed
  ld: fontutils.o: undefined reference to symbol 'FT_Load_Char'
  ld: /usr/X11R7/lib/libfreetype.so.19: error adding symbols: DSO missing from command line


Hardware:
 Apple Mac mini M1 2020 A2348 
 USB SSD 512GB BUFFALO SSD-PGM2.0U3-BC

Filesystem   1M-blocks      Used     Avail %Cap Mounted on
/dev/dk6        480587    242086    214471  53% /
/dev/dk5            79        34        44  43% /boot
ptyfs                0         0         0 100% /dev/pts
procfs               0         0         0 100% /proc
tmpfs             1913         0      1913   0% /var/shm
/dev/sd1a       946388    411492    487577  45% /media

ToDo:
- audio
- Wireless LAN

pkgsrc:
- pkgsrc packages:
 http://cdn.netbsd.org/pub/NetBSD/misc/jun/aarch64/aarch64/2022/
  pkgin support

System Updates:

sysinfo:
 bozohttpd-20230602 openssl-3.0.9 sh-20220122-20230609102455Z

pkgsrc:
 ImageMagick-7.1.1.11 ImageMagick6-6.9.11.7nb22 a2ps-4.15.4nb2
 babl-0.1.98nb2 cargo-c-0.9.19 cbindgen-0.24.6
 chatgpt-shell-cli-0.0.20230516 cmake-3.26.4 curl-8.1.2
 dav1d-1.2.1 dconf-0.40.0nb4 double-conversion-3.3.0
 emacs26-26.3nb29 enchant2-2.5.0 ffmpeg5-5.1.3nb3 ffmpeg6-6.0nb1
 firefox-112.0.1nb4 fmtlib-10.0.0 freeimage-3.18.0nb12 fribidi-1.0.13
 gawk-5.2.2 gcr-3.38.1nb7 gd-2.3.3nb10 gegl-0.4.40nb9 gexiv2-0.14.1nb1
 gimp-2.10.32nb13 git-base-2.41.0 glib-networking-2.74.0nb2
 glib2-2.74.6nb1 gnupg2-2.4.2 gnutls-3.8.0nb3 graphviz-8.0.5
 gspell-1.8.3nb14 gssdp-1.0.3nb26 gst-plugins1-bad-1.22.3
 gst-plugins1-base-1.22.3 gst-plugins1-good-1.22.3 gstreamer1-1.22.3
 gtk3+-3.24.38 gupnp-1.0.3nb23 harfbuzz-7.3.0 harfbuzz-icu-7.3.0
 http-parser-2.9.4 hunspell-1.7.2nb2 imath-3.1.9 inih-53 libXaw3d-1.6.5
 libdbusmenu-glib-12.10.2nb18 libdbusmenu-gtk3-12.10.2nb29
 libgit2-1.6.4nb1 libgweather-40.0nb14 libheif-1.16.2 libimagequant-4.2.0
 libixion-0.17.0nb3 libmatekbd-1.26.1 libmateweather-1.26.1
 libproxy-0.5.1nb1 libsecret-0.20.4nb8 libsixel-1.8.6nb13 libssh2-1.11.0
 libuv-1.45.0 libxfce4ui-4.18.4 libxslt-1.1.38 lua54-5.4.6 luatex-1.17.0
 m17n-lib-1.8.0nb12 mate-media-1.26.1 mate-notification-daemon-1.26.1
 mate-screensaver-1.26.2 mate-settings-daemon-1.26.1 mate-terminal-1.26.1
 mate-themes-3.22.24 mate-utils-1.26.1 meson-1.1.1 midori-9.0nb26
 mlterm-3.9.3nb2 mozilla-rootcerts-1.0.20230505
 mozilla-rootcerts-openssl-2.11 nettle-3.9.1 ng-spice-shared-40
 nghttp2-1.54.0 nginx-1.24.0nb7 openexr-3.1.7nb3 orc-0.4.34
 osabi-NetBSD-10.99.4 osg-3.6.5nb37 p5-Alien-Build-2.80
 p5-B-Hooks-EndOfScope-0.26 p5-CPAN-Meta-Check-0.017 p5-Data-OptList-0.114
 p5-DateTime-Locale-1.38 p5-Devel-Caller-2.07 p5-FFI-CheckLib-0.31
 p5-File-Listing-6.15 p5-File-ShareDir-Install-0.14 p5-File-chdir-0.1011
 p5-HTTP-CookieJar-0.014 p5-IO-Socket-SSL-2.081 p5-JSON-4.10
 p5-List-SomeUtils-0.59 p5-List-UtilsBy-0.12 p5-Locale-libintl-1.33
 p5-MRO-Compat-0.15 p5-Module-Build-0.42340 p5-Module-Build-Tiny-0.045
 p5-Net-3.15 p5-Net-DNS-1.38 p5-OLE-Storage_Lite-0.22
 p5-Package-DeprecationManager-0.18 p5-Package-Stash-0.40
 p5-Package-Stash-XS-0.30 p5-Params-Util-1.102 p5-Params-Validate-1.31
 p5-Params-ValidationCompiler-0.31 p5-Scalar-List-Utils-1.63
 p5-Sub-Exporter-0.989 p5-Sub-Install-0.929 p5-Sub-Name-0.27
 p5-Sub-Quote-2.006008 p5-Term-Table-0.016 p5-Test-Without-Module-0.21
 p5-Test2-Suite-0.000155 p5-URI-5.19 p5-XML-LibXML-2.0208
 p5-libwww-6.70 pcsc-lite-2.0.0 php74-gd-7.4.33nb5
 pkg_rolling-replace-0.24.14 pkgconf-1.9.5 pluma-1.26.1 polkit-121
 postgresql14-client-14.8 psutils-3.0.3 py-gobject3-common-3.44.1
 py310-OpenSSL-23.2.0 py310-argparse-manpage-4.3 py310-cElementTree-3.10.12
 py310-certifi-2023.5.7 py310-cryptodome-3.18.0 py310-cryptography-41.0.1
 py310-curses-3.10.12nb6 py310-docutils-0.20.1 py310-expat-3.10.12nb1
 py310-flit_core-3.9.0 py310-gobject3-3.44.1 py310-hatchling-1.17.1
 py310-markupsafe-2.1.3 py310-pdf-3.9.0 py310-poetry-core-1.6.1
 py310-pspdfutils-3.0.3 py310-puremagic-1.15 py310-readline-3.10.12
 py310-requests-2.31.0 py310-roman-4.1 py310-scons-4.5.2nb1
 py310-setuptools-67.8.0 py310-sphinx-7.0.1 py310-sqlite3-3.10.12nb24
 py310-trove-classifiers-2023.5.24 py310-urllib3-2.0.3 python27-2.7.18nb11
 python310-3.10.12 python37-3.7.17 python38-3.8.17 python39-3.9.17
 qmmp-1.5.1nb17 qt5-qtbase-5.15.9nb2 qt5-qtdeclarative-5.15.9nb2
 qt5-qtlocation-5.15.9nb2 qt5-qtmultimedia-5.15.9nb3 qt5-qtsensors-5.15.9nb2
 qt5-qtserialport-5.15.9nb2 qt5-qtsvg-5.15.9nb2 qt5-qttools-5.15.9nb3
 qt5-qtwebchannel-5.15.9nb2 qt5-qtwebsockets-5.15.9nb2
 qt5-qtx11extras-5.15.9nb2 qt5-qtxmlpatterns-5.15.9nb2
 ruby31-addressable-2.8.4 ruby31-atk-4.1.7 ruby31-cairo-gobject-4.1.7
 ruby31-gdk3-4.1.7 ruby31-gdk_pixbuf2-4.1.7 ruby31-gio2-4.1.7
 ruby31-glib2-4.1.7 ruby31-gobject-introspection-4.1.7
 ruby31-gtk3-4.1.7 ruby31-mini_portile2-2.8.2 ruby31-pango-4.1.7
 ruby31-red-datasets-0.1.7 ruby31-version_gem-1.1.3 scribus-1.5.8nb15
 serf-1.3.10nb1 spdlog-1.11.0nb2 sqlite3-3.42.0 tigervnc-1.13.1.1.20.13nb2
 uim-1.8.9nb3 vala-0.56.8nb1 vte3-0.72.1nb1 wget-1.21.4
 xfce4-4.18.0nb7 xfce4-mousepad-0.6.1 xfce4-panel-4.18.4
 xfce4-power-manager-4.18.2 xfce4-session-4.18.3 xorgproto-2023.1

Version: 
 NetBSD 10.99.4 (GENERIC64) #0: Fri Jun  9 10:24:55 UTC 2023  mkrepro@mkrepro.NetBSD.org:/usr/src/sys/arch/evbarm/compile/GENERIC64

dmesg:
 https://github.com/ebijun/NetBSD/blob/master/dmesg/aarch64/Apple_Mac_mini_M1_2020

sysinfo:
 https://github.com/ebijun/NetBSD/blob/master/apple-m1/sysinfo

pkginfo:
 https://github.com/ebijun/NetBSD/blob/master/apple-m1/pkginfo

pkgchk.conf:
 https://github.com/ebijun/NetBSD/blob/master/apple-m1/pkgchk.conf
  cp pkgchk.conf /usr/pkgsrc;pkg_add pkg_chk; pkg_chk -au

--
Jun Ebihara
