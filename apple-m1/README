To: port-arm%netbsd.org@localhost
Subject: apple m1 status update (20240817)

Install:
 https://wiki.netbsd.org/ports/evbarm/apple/

Update:
 firefox-129.0 works well
 libreoffice-24.2.5.2nb1 works well
 python312-3.12.5
 rust-1.79.0
 samba-4.20.4
 sayaka-3.7.7

Topics:
- USB2 audio

works ok
 uaudio0 at uhub5 port 1 configuration 1 interface 0
 uaudio0: LUXMAN LXU-OT2 (0x08bb) LUXMAN LXU-OT2 (0x2704), rev 1.10/1.00, addr 17
 uaudio0: audio rev 1.00
 audio0 at uaudio0: playback
 audio0: slinear_le:16 2ch 48000Hz, blk 11520 bytes (60ms) for playback

recognize ok ,but sound output awful just like boss overdrive compressor.
 uaudio0 at uhub5 port 1 configuration 1 interface 0
 uaudio0: Topping (0x152a) D10s (0x8750), rev 2.00/1.04, addr 5
 uaudio0: ignored setting with format 0x80000000
 uaudio0: audio rev 2.00
 audio0 at uaudio0: playback
 audio0: slinear_le:16 2ch 48000Hz, blk 11520 bytes (30ms) for playback

- pkgsrc/textproc/ruby-nokogiri
  make package 
    ok with ar 2.34
    failed with ar 2.39

- X
 startx failed with signal 11,
 till NetBSD-10.99.2-evbarm-aarch64-202302150640Z

X.Org X Server 1.21.1.7
[    40.591] (EE) Backtrace:
[    40.592] (EE) 0: /usr/X11R7/bin/X (xorg_backtrace+0x3c) [0x9761b8c]
[    40.592] (EE) 1: /usr/X11R7/bin/X (os_move_fd+0x78) [0x975d4f8]
[    40.592] (EE) 2: /usr/lib/libc.so.12 (__sigtramp_siginfo_2+0x0) [0xf7d48807e1e8]
[    40.592] (EE) 3: /usr/X11R7/bin/X (CreateColormap+0x418) [0x9644a68]
[    40.592] (EE) 4: /usr/X11R7/bin/X (miCreateDefColormap+0x84) [0x96b7744]
[    40.592] (EE) 5: /usr/X11R7/lib/modules/drivers/wsfb_drv.so (+0x147c) [0xf7d4874e322c]
[    40.592] (EE) 6: /usr/X11R7/bin/X (AddScreen+0xac) [0x9639c6c]
[    40.592] (EE) 7: /usr/X11R7/bin/X (InitOutput+0x26c) [0x967616c]
[    40.592] (EE) 8: /usr/X11R7/bin/X (dix_main+0x1a0) [0x9608fd0]
[    40.592] (EE) 
[    40.592] (EE) Segmentation fault at address 0xf7d487aa07f0
[    40.592] (EE) 
Fatal server error:
[    40.592] (EE) Caught signal 11 (Segmentation fault). Server aborting

 startx but colormap
  https://twitter.com/ebijun/status/1583622834990956545
 
 startx -- -depth 30
  http://mail-index.netbsd.org/port-arm/2021/10/21/msg007458.html
  https://twitter.com/ebijun/status/1480042814704873473

 application checked via tigervnc.
  https://twitter.com/ebijun/status/1615544069161357314

- pkgsrc/net/tigervnc build failed depends:
  x11/libXfont2:
  ERROR: This package has set PKG_SKIP_REASON:
  ERROR: Package set is using native X11 component
  works with comment out 
  #.include "../../x11/libXfont2/buildlink3.mk"

- pkgsrc/x11/xterm failed
  ld: fontutils.o: undefined reference to symbol 'FT_Load_Char'
  ld: /usr/X11R7/lib/libfreetype.so.19: error adding symbols: DSO missing from command line


Hardware:
 Apple Mac mini M1 2020 A2348 
 USB SSD 512GB BUFFALO SSD-PGM2.0U3-BC

Filesystem   1M-blocks      Used     Avail %Cap Mounted on
/dev/dk6        480587    255366    201191  55% /
/dev/dk5            79        34        44  43% /boot
ptyfs                0         0         0 100% /dev/pts
procfs               0         0         0 100% /proc
tmpfs             1912        10      1902   0% /var/shm
/dev/sd1a       946388    477110    421958  53% /media

ToDo:
- audio
- Wireless LAN

pkgsrc:
- pkgsrc packages:
 http://cdn.netbsd.org/pub/NetBSD/misc/jun/aarch64/aarch64/2024/
  pkgin support

System Updates:

sysinfo:
  libc-12.222 sh-20220122-20240816060454Z
 
pkgsrc:
 ImageMagick-7.1.1.35 SDL2-2.30.6 abseil-20240722.0 apache-2.4.62
 appstream-1.0.3nb2 asciidoc-10.2.1 box2d-2.4.2 clang-18.1.8 cmake-3.30.2
 curl-8.9.1 deforaos-libdatabase-0.1.0nb4 desktop-file-utils-0.27 exiv2-0.28.3
 ffmpeg6-6.1.2 ffmpeg7-7.0.2 firefox-129.0 firefox-l10n-129.0 fmtlib-11.0.2
 gdbus-codegen-2.80.4 gexiv2-0.14.3 ghostscript-agpl-10.03.1nb2 git-base-2.46.0
 glib2-2.80.4 glib2-tools-2.80.4 gnupg2-2.4.5nb3 googletest-1.15.2
 gpgme-1.23.2nb1 gtk3+-3.24.43 jpeg-9f json-glib-1.8.0 libadwaita-1.5.2
 libassuan-3.0.1 libdeflate-1.21 libgcrypt-1.11.0 libheif-1.18.2
 libimagequant-4.3.3 libixion-0.19.0nb1 libmtp-1.1.21 libnotify-0.8.3
 libproxy-0.5.8 libreoffice-24.2.5.2nb1 libstemmer-2.2.0nb1 libunwind-18.1.8
 libupnp-1.14.19 libva-2.22.0 libxml2-2.12.8nb1 libxmlb-0.3.14 lld-18.1.8
 lz4-1.10.0 marco-1.26.2nb6 mbedtls-2.28.3nb1 meson-1.5.1 mpg123-1.32.7
 nss-3.103 opusfile-0.12nb3 orc-0.4.39 osabi-NetBSD-10.99.11
 p5-DateTime-Locale-1.43 p5-HTML-Parser-3.83 p5-IO-Socket-SSL-2.088
 p5-IPC-Run3-0.049 p5-Mozilla-CA-20240730 p5-Scalar-List-Utils-1.65
 p5-Sub-Override-0.12 p5-Term-Table-0.022 p5-Test-Without-Module-0.23
 pinentry-1.3.1nb1 pkgconf-2.3.0 postgresql14-client-14.13 protobuf-27.3
 py27-setuptools-44.1.1nb1 py311-OpenSSL-24.2.1 py311-alabaster-1.0.0
 py311-babel-2.16.0 py311-cffi-1.17.0 py311-cryptography-43.0.0
 py311-importlib-metadata-8.2.0 py311-libxml2-2.12.8nb1 py311-lxml-5.3.0
 py311-pdf-4.3.1 py311-pip-24.2 py311-pspdfutils-3.3.4 py311-puremagic-1.27
 py311-scons-4.8.0 py311-setuptools-72.1.0 py311-setuptools-rust-1.10.1
 py311-sphinx-8.0.2 py311-sphinxcontrib-applehelp-2.0.0
 py311-sphinxcontrib-devhelp-2.0.0 py311-sphinxcontrib-htmlhelp-2.1.0
 py311-sphinxcontrib-qthelp-2.0.0 py311-sphinxcontrib-serializinghtml-2.0.0
 py311-wheel-0.44.0 py311-zstandard-0.23.0 py312-toml-0.10.2nb3
 py312-tomli-2.0.1nb1 python312-3.12.5 ruby32-atk-4.2.2 ruby32-base-3.2.5
 ruby32-cairo-1.17.12nb3 ruby32-cairo-gobject-4.2.2 ruby32-gdk3-4.2.2
 ruby32-gdk_pixbuf2-4.2.2 ruby32-gio2-4.2.2 ruby32-glib2-4.2.2
 ruby32-gobject-introspection-4.2.2 ruby32-gtk3-4.2.2 ruby32-locale-2.1.4
 ruby32-native-package-installer-1.1.9 ruby32-pango-4.2.2
 ruby32-pkg-config-1.5.6 ruby32-public_suffix-6.0.1 ruby32-red-colors-0.4.0
 ruby32-simpleidn-0.2.3 ruby32-version_gem-1.1.4 rust-1.79.0 samba-4.20.4
 sayaka-3.7.7 spdlog-1.14.1nb1 sylpheed-3.7.0nb17 tdb-1.4.12
 tree-sitter-cpp-0.22.3 unixodbc-2.3.12nb1 unzip-6.0nb10 webkit-gtk-2.36.8nb15
 wslay-1.1.1 wxGTK32-3.2.5nb2 x11-links-1.36 xfce4-4.18.1nb17
 xfce4-thunar-4.18.11 xnp2-0.86nb26 zenity3-3.44.4 zziplib-0.13.78

Version: 
 NetBSD 10.99.11 (GENERIC64) #0: Fri Aug 16 06:04:54 UTC 2024  mkrepro@mkrepro.NetBSD.org:/usr/src/sys/arch/evbarm/compile/GENERIC64

dmesg:
 https://github.com/ebijun/NetBSD/blob/master/dmesg/aarch64/Apple_Mac_mini_M1_2020

sysinfo:
 https://github.com/ebijun/NetBSD/blob/master/apple-m1/sysinfo

pkginfo:
 https://github.com/ebijun/NetBSD/blob/master/apple-m1/pkginfo

pkgchk.conf:
 https://github.com/ebijun/NetBSD/blob/master/apple-m1/pkgchk.conf
  cp pkgchk.conf /usr/pkgsrc;pkg_add pkg_chk; pkg_chk -au

--
Jun Ebihara
